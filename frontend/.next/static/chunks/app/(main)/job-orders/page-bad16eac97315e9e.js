(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[675],{283:(e,t,s)=>{"use strict";s.d(t,{A:()=>n,AuthProvider:()=>d});var r=s(5155),a=s(2115),l=s(5695);let o=(0,a.createContext)(void 0),n=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},d=e=>{let{children:t}=e,[s,n]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),i=(0,l.useRouter)(),m=async()=>{try{let e=await fetch("".concat("http://localhost:5001","/auth/me"),{credentials:"include"});if(e.ok){let t=await e.json();n(t.user)}else n(null)}catch(e){console.error("Auth check failed:",e),n(null)}finally{c(!1)}},x=async(e,t,s)=>{let r=await fetch("".concat("http://localhost:5001","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:t,rememberMe:s})});if(!r.ok)throw Error((await r.json()).message||"Login failed");n((await r.json()).user),i.push("/dashboard")},h=async()=>{try{await fetch("".concat("http://localhost:5001","/auth/logout"),{method:"POST",credentials:"include"})}catch(e){console.error("Logout failed:",e)}finally{n(null),i.push("/login")}};return(0,a.useEffect)(()=>{m()},[]),(0,r.jsx)(o.Provider,{value:{user:s,loading:d,login:x,logout:h,checkAuth:m},children:t})}},646:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1007:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},1243:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},3904:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},4186:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},4229:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},4382:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>q});var r=s(5155),a=s(2115),l=s(283),o=s(6440),n=s(7434),d=s(5339),c=s(9946);let i=(0,c.A)("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);var m=s(3904),x=s(1007),h=s(9420),u=s(7930),g=s(8136),b=s(8313),p=s(4416);let y=(0,c.A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var f=s(4229);function j(e){var t,s;let{mode:l,onSubmit:o,onCancel:c,initial:j,submitLabel:N,onSuccess:v}=e,[w,k]=(0,a.useState)(!1),[C,A]=(0,a.useState)(null),[E,O]=(0,a.useState)(!1),[S,D]=(0,a.useState)(!1),[P,M]=(0,a.useState)(null),[J,T]=(0,a.useState)({jobNumber:(null==j?void 0:j.jobNumber)||"",customerName:(null==j?void 0:j.customerName)||"",phoneNumber:(null==j?void 0:j.phoneNumber)||"",carType:(null==j?void 0:j.carType)||"",licensePlate:(null==j?void 0:j.licensePlate)||"",issueDetail:(null==j?void 0:j.issueDetail)||"",jobDetail:(null==j?void 0:j.jobDetail)||"",branchId:(null==j?void 0:j.branchId)||1});(0,a.useEffect)(()=>{"create"===l&&J.licensePlate.trim()&&L(J.licensePlate.trim())},[J.licensePlate,l]);let L=async e=>{if(e&&"edit"!==l){O(!0);try{let t=e.replace(/[^a-zA-Z0-9ก-๙]/g,""),s=await fetch("".concat("http://localhost:5001","/job-orders/next-sequence?licensePlate=").concat(encodeURIComponent(t)),{credentials:"include"});if(s.ok){let e=await s.json(),r="JOB-".concat(t,"-").concat(String(e.nextSequence).padStart(3,"0"));T(e=>({...e,jobNumber:r}))}else{let e=Date.now().toString().slice(-4),s="JOB-".concat(t,"-").concat(e);T(e=>({...e,jobNumber:s}))}}catch(a){console.error("Error generating job number:",a);let t=e.replace(/[^a-zA-Z0-9ก-๙]/g,""),s=Date.now().toString().slice(-4),r="JOB-".concat(t,"-").concat(s);T(e=>({...e,jobNumber:r}))}finally{O(!1)}}};async function z(e){if(e.preventDefault(),console.log("Form submitted:",{mode:l,form:J}),"edit"===l){M(J),D(!0);return}k(!0),A(null);try{await o(J),console.log("Form submission successful")}catch(e){console.error("Form submission error:",e),A((null==e?void 0:e.message)||"Submit failed")}finally{k(!1)}}let F=async()=>{if(P){k(!0),A(null);try{if(console.log("\uD83D\uDD0D JobOrderForm: Submitting data to backend:",P),console.log("\uD83D\uDD0D JobOrderForm: Data type:",typeof P),console.log("\uD83D\uDD0D JobOrderForm: Data keys:",Object.keys(P)),"edit"===l){console.log("\uD83D\uDD0D JobOrderForm: Sending PUT request to backend...");let e=await fetch("".concat("http://localhost:5001","/job-orders/").concat(null==j?void 0:j.id),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(P)});if(console.log("\uD83D\uDD0D JobOrderForm: Backend response status:",e.status),!e.ok){let t=await e.json();throw Error(t.message||"Update failed")}let t=await e.json();console.log("\uD83D\uDD0D JobOrderForm: Backend update successful:",t),v&&(console.log("\uD83D\uDD0D JobOrderForm: Calling onSuccess with backend data:",t.item),v(t.item))}else await o(P),console.log("\uD83D\uDD0D JobOrderForm: Form submission successful");D(!1),M(null),c()}catch(e){console.error("\uD83D\uDD0D JobOrderForm: Form submission error:",e),A((null==e?void 0:e.message)||"Submit failed")}finally{k(!1)}}};return(0,r.jsxs)("div",{className:"py-4 px-4 md:py-6 md:px-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 md:gap-4 mb-6 md:mb-8",children:[(0,r.jsx)("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl md:rounded-2xl flex items-center justify-center shadow-lg",children:(0,r.jsx)(n.A,{className:"w-6 h-6 md:w-7 md:h-7 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 mb-1 md:mb-2",children:"create"===l?"สร้างงานสั่งทำใหม่":"แก้ไขงานสั่งทำ"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm md:text-lg",children:"create"===l?"กรอกข้อมูลงานสั่งทำใหม่":"อัปเดตข้อมูลงานสั่งทำ"})]})]}),(0,r.jsxs)("form",{onSubmit:z,className:"space-y-6",children:[C&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-5 h-5 bg-red-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(d.A,{className:"w-3 h-3 text-red-600"})}),(0,r.jsx)("p",{className:"text-sm text-red-700",children:C})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i,{className:"w-4 h-4 text-gray-500"}),"เลขทะเบียนรถ *"]})}),(0,r.jsx)("input",{className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-base",value:J.licensePlate,onChange:e=>{let t=e.target.value;T({...J,licensePlate:t})},placeholder:"กข-1234",required:!0}),"create"===l&&(0,r.jsx)("p",{className:"text-sm text-gray-500 bg-gray-50 px-3 py-2 rounded-lg border border-gray-200",children:"เลขที่งานจะถูกสร้างอัตโนมัติเมื่อกรอกเลขทะเบียนรถ"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i,{className:"w-4 h-4 text-gray-500"}),"เลขที่งาน *","create"===l&&(0,r.jsx)("span",{className:"text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full",children:"สร้างอัตโนมัติ"})]})}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ".concat("create"===l?"bg-gray-50 cursor-not-allowed":""),value:J.jobNumber,onChange:e=>"edit"===l&&T({...J,jobNumber:e.target.value}),placeholder:"create"===l?"กรอกเลขทะเบียนรถก่อน...":"JOB-001",readOnly:"create"===l,required:!0}),"create"===l&&J.licensePlate&&(0,r.jsx)("button",{type:"button",onClick:()=>{J.licensePlate.trim()&&L(J.licensePlate.trim())},disabled:E,className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-gray-400 hover:text-gray-600 transition-colors",title:"สร้างเลขที่งานใหม่",children:(0,r.jsx)(m.A,{className:"w-4 h-4 ".concat(E?"animate-spin":"")})})]}),E&&(0,r.jsx)("p",{className:"text-xs text-blue-600 animate-pulse",children:"กำลังสร้างเลขที่งาน..."})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.A,{className:"w-4 h-4 text-gray-500"}),"ชื่อลูกค้า *"]})}),(0,r.jsx)("input",{className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:J.customerName,onChange:e=>T({...J,customerName:e.target.value}),placeholder:"ชื่อลูกค้า",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.A,{className:"w-4 h-4 text-gray-500"}),"เบอร์โทรศัพท์ *"]})}),(0,r.jsx)("input",{className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:J.phoneNumber,onChange:e=>T({...J,phoneNumber:e.target.value}),placeholder:"080-123-4567",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.A,{className:"w-4 h-4 text-gray-500"}),"ประเภทรถ *"]})}),(0,r.jsx)("input",{className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:J.carType,onChange:e=>T({...J,carType:e.target.value}),placeholder:"Toyota Camry",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.A,{className:"w-4 h-4 text-gray-500"}),"สาขา *"]})}),(0,r.jsx)("select",{className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white",value:J.branchId,onChange:e=>T({...J,branchId:Number(e.target.value)}),required:!0,children:(0,r.jsx)("option",{value:1,children:"Main Branch"})})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(d.A,{className:"w-4 h-4 text-gray-500"}),"รายละเอียดปัญหา"]})}),(0,r.jsx)("textarea",{className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none",rows:3,value:null!=(t=J.issueDetail)?t:"",onChange:e=>T({...J,issueDetail:e.target.value}),placeholder:"อธิบายปัญหาที่พบ..."})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(b.A,{className:"w-4 h-4 text-gray-500"}),"รายละเอียดงาน"]})}),(0,r.jsx)("textarea",{className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none",rows:3,value:null!=(s=J.jobDetail)?s:"",onChange:e=>T({...J,jobDetail:e.target.value}),placeholder:"อธิบายงานที่จะทำ..."})]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-end gap-4 md:gap-6 pt-6 md:pt-8 border-t border-gray-200",children:[(0,r.jsxs)("button",{type:"button",onClick:c,className:"w-full sm:w-auto flex items-center justify-center gap-2 md:gap-3 px-6 md:px-8 py-3 md:py-4 border-2 border-gray-300 text-gray-700 rounded-lg md:rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 font-medium text-sm md:text-base",children:[(0,r.jsx)(p.A,{className:"w-4 h-4 md:w-5 md:h-5"}),"ยกเลิก"]}),(0,r.jsx)("button",{type:"submit",disabled:w||"create"===l&&!J.jobNumber,className:"w-full sm:w-auto flex items-center justify-center gap-2 md:gap-3 px-6 md:px-8 py-3 md:py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg md:rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg text-sm md:text-base",children:w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y,{className:"w-4 h-4 md:w-5 md:h-5 animate-spin"}),"กำลังบันทึก..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.A,{className:"w-4 h-4 md:w-5 md:h-5"}),N||"บันทึก"]})})]})]}),S&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 animate-in fade-in duration-200 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg md:rounded-2xl p-6 md:p-8 max-w-md w-full shadow-2xl animate-in zoom-in-95 duration-200",children:[(0,r.jsx)("h3",{className:"text-lg md:text-xl font-semibold text-blue-600 mb-3 md:mb-4",children:"ยืนยันการแก้ไข"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6 md:mb-8 text-sm md:text-base",children:"คุณต้องการบันทึกการเปลี่ยนแปลงงานสั่งทำนี้หรือไม่?"}),(0,r.jsxs)("div",{className:"bg-blue-50 rounded-xl p-4 mb-6 border border-blue-200",children:[(0,r.jsx)("h4",{className:"font-semibold text-blue-800 mb-3",children:"สรุปการเปลี่ยนแปลง:"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(null==j?void 0:j.customerName)!==J.customerName&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"ชื่อลูกค้า:"}),(0,r.jsxs)("span",{className:"font-medium text-gray-600",children:[null==j?void 0:j.customerName," → ",J.customerName]})]}),(null==j?void 0:j.phoneNumber)!==J.phoneNumber&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"เบอร์โทร:"}),(0,r.jsxs)("span",{className:"font-medium text-gray-600",children:[null==j?void 0:j.phoneNumber," → ",J.phoneNumber]})]}),(null==j?void 0:j.carType)!==J.carType&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"ประเภทรถ:"}),(0,r.jsxs)("span",{className:"font-medium",children:[null==j?void 0:j.carType," → ",J.carType]})]}),(null==j?void 0:j.licensePlate)!==J.licensePlate&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"เลขทะเบียน:"}),(0,r.jsxs)("span",{className:"font-medium",children:[null==j?void 0:j.licensePlate," → ",J.licensePlate]})]}),(null==j?void 0:j.issueDetail)!==J.issueDetail&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"รายละเอียดปัญหา:"}),(0,r.jsx)("span",{className:"font-medium text-blue-600",children:"มีการเปลี่ยนแปลง"})]}),(null==j?void 0:j.jobDetail)!==J.jobDetail&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"รายละเอียดงาน:"}),(0,r.jsx)("span",{className:"font-medium text-blue-600",children:"มีการเปลี่ยนแปลง"})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 md:gap-4",children:[(0,r.jsx)("button",{onClick:()=>D(!1),disabled:w,className:"flex-1 px-4 md:px-6 py-2 md:py-3 border border-gray-300 text-gray-700 rounded-lg md:rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50 font-medium text-sm md:text-base",children:"ยกเลิก"}),(0,r.jsx)("button",{onClick:F,disabled:w,className:"flex-1 px-4 md:px-6 py-2 md:py-3 bg-blue-600 text-white rounded-lg md:rounded-xl hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2 font-medium text-sm md:text-base",children:w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y,{className:"w-4 h-4 md:w-5 md:h-5 animate-spin"}),"กำลังบันทึก..."]}):"ยืนยันการแก้ไข"})]})]})})]})}var N=s(4186),v=s(646);let w=(0,c.A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var k=s(1243);let C=(0,c.A)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var A=s(2525),E=s(9074);function O(e){var t;let{jobOrder:s,onClose:l,onEdit:o,onDelete:d}=e,[c,i]=(0,a.useState)("view"),[h,g]=(0,a.useState)(!1),[f,O]=(0,a.useState)(!1),[S,D]=(0,a.useState)(null),[P,M]=(0,a.useState)(!1),[J,T]=(0,a.useState)(s),[L,z]=(0,a.useState)(0);console.log("\uD83D\uDD0D JobOrderDetail: Component rendered with currentJobOrder:",J),console.log("\uD83D\uDD0D JobOrderDetail: Props jobOrder:",s),(0,a.useEffect)(()=>{!J&&s&&(console.log("\uD83D\uDD0D JobOrderDetail: Initializing currentJobOrder with jobOrder props"),T(s))},[J,s]);let F=()=>{console.log("\uD83D\uDD0D JobOrderDetail: Triggering refresh..."),z(e=>e+1)};async function I(e){D(e),O(!0)}async function R(){M(!0);try{await d(),g(!1),l()}catch(e){console.error("Error deleting job order:",e)}finally{M(!1)}}if((0,a.useEffect)(()=>{L>0&&(null==J?void 0:J.id)&&(console.log("\uD83D\uDD0D JobOrderDetail: Refresh triggered, fetching fresh data..."),(async()=>{try{let e=await fetch("".concat("http://localhost:5001","/job-orders/").concat(J.id),{credentials:"include"});if(e.ok){let t=await e.json();console.log("\uD83D\uDD0D JobOrderDetail: Fresh data fetched:",t),T(t),console.log("\uD83D\uDD0D JobOrderDetail: State updated with fresh data")}else console.warn("\uD83D\uDD0D JobOrderDetail: Failed to fetch fresh data")}catch(e){console.error("\uD83D\uDD0D JobOrderDetail: Error fetching fresh data:",e)}})())},[L,null==J?void 0:J.id]),!J)return(0,r.jsx)("div",{className:"p-4 md:p-6 lg:p-8 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(y,{className:"w-8 h-8 text-gray-400 animate-spin"})}),(0,r.jsx)("p",{className:"text-gray-500",children:"กำลังโหลดข้อมูล..."})]})});let G=(e=>{switch(e){case"PENDING":case"OPEN":return{label:"เปิดงาน",color:"bg-orange-100 text-orange-800 border-orange-200",icon:(0,r.jsx)(N.A,{className:"w-4 h-4"}),bgColor:"bg-orange-50"};case"IN_PROGRESS":return{label:"กำลังดำเนินการ",color:"bg-blue-100 text-blue-800 border-blue-200",icon:(0,r.jsx)(b.A,{className:"w-4 h-4"}),bgColor:"bg-blue-50"};case"COMPLETED":return{label:"เสร็จสิ้น",color:"bg-green-100 text-green-800 border-green-200",icon:(0,r.jsx)(v.A,{className:"w-4 h-4"}),bgColor:"bg-green-50"};case"CANCELLED":return{label:"ยกเลิก",color:"bg-red-100 text-red-800 border-red-200",icon:(0,r.jsx)(w,{className:"w-4 h-4"}),bgColor:"bg-red-50"};default:return{label:e,color:"bg-gray-100 text-gray-800 border-gray-200",icon:(0,r.jsx)(k.A,{className:"w-4 h-4"}),bgColor:"bg-gray-50"}}})(J.status);return"edit"===c?(0,r.jsxs)("div",{className:"p-4 md:p-6 lg:p-8 space-y-4 md:space-y-6 animate-in slide-in-from-right-2 duration-300",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between pb-4 md:pb-6 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-lg md:text-xl font-semibold text-gray-900",children:"แก้ไขงานสั่งทำ"}),(0,r.jsx)("button",{onClick:()=>i("view"),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(p.A,{size:20})})]}),(0,r.jsx)(j,{mode:"edit",initial:s,onSubmit:I,onCancel:()=>i("view"),submitLabel:"บันทึกการแก้ไข",onSuccess:async e=>{F(),console.log("\uD83D\uDD0D JobOrderDetail: onSuccess called with data:",e),console.log("\uD83D\uDD0D JobOrderDetail: Previous state:",J);try{if(console.log("\uD83D\uDD0D JobOrderDetail: Fetching fresh data from database..."),!(null==J?void 0:J.id))return void console.error("\uD83D\uDD0D JobOrderDetail: currentJobOrder.id is undefined, cannot fetch fresh data");let t=await fetch("".concat("http://localhost:5001","/job-orders/").concat(J.id),{credentials:"include"});if(t.ok){let e=await t.json();T(e.item),console.log("\uD83D\uDD0D JobOrderDetail: State updated with fresh data from database")}else if(console.warn("\uD83D\uDD0D JobOrderDetail: Failed to fetch fresh data, using local update"),J){let t={...J,...e};T(t)}}catch(t){console.error("\uD83D\uDD0D JobOrderDetail: Error fetching fresh data:",t),J&&T({...J,...e})}}})]}):(0,r.jsxs)("div",{className:"p-4 md:p-6 lg:p-8 space-y-6 md:space-y-8 animate-in slide-in-from-bottom-2 duration-300",children:[(0,r.jsxs)("div",{className:"space-y-4 pb-6 md:pb-8 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 md:gap-4 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl md:rounded-2xl flex items-center justify-center shadow-lg flex-shrink-0",children:(0,r.jsx)(n.A,{className:"w-6 h-6 md:w-8 md:h-8 text-white"})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsxs)("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-gray-900 mb-1 md:mb-2 truncate",children:["#",J.jobNumber]}),(0,r.jsx)("p",{className:"text-sm md:text-base lg:text-lg text-gray-600",children:"งานสั่งทำรถยนต์"})]})]}),(0,r.jsxs)("button",{onClick:l,className:"p-2 md:p-3 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg md:rounded-xl transition-all duration-200 hover:shadow-sm flex-shrink-0",children:[(0,r.jsx)(p.A,{size:20,className:"md:hidden"}),(0,r.jsx)(p.A,{size:24,className:"hidden md:block"})]})]}),(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 md:gap-3 px-4 md:px-6 py-2 md:py-3 rounded-full border-2 ".concat(G.color," ").concat(G.bgColor," shadow-sm transition-all duration-200 hover:shadow-md"),children:[G.icon,(0,r.jsx)("span",{className:"font-semibold text-sm md:text-base",children:G.label})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,r.jsxs)("button",{onClick:()=>i("edit"),className:"flex items-center justify-center gap-2 px-4 md:px-6 py-2 md:py-3 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg md:rounded-xl transition-all duration-200 font-medium hover:shadow-sm border border-blue-200 text-sm md:text-base",children:[(0,r.jsx)(C,{size:16,className:"md:hidden"}),(0,r.jsx)(C,{size:18,className:"hidden md:block"}),"แก้ไข"]}),(0,r.jsxs)("button",{onClick:F,className:"flex items-center justify-center gap-2 px-4 md:px-6 py-2 md:py-3 text-green-600 hover:text-green-700 hover:bg-green-50 rounded-lg md:rounded-xl transition-all duration-200 font-medium hover:shadow-sm border border-green-200 text-sm md:text-base",title:"รีเฟรชข้อมูล",children:[(0,r.jsx)(m.A,{size:16,className:"md:hidden"}),(0,r.jsx)(m.A,{size:18,className:"hidden md:block"}),"รีเฟรช"]}),(0,r.jsxs)("button",{onClick:()=>g(!0),className:"flex items-center justify-center gap-2 px-4 md:px-6 py-2 md:py-3 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg md:rounded-xl transition-all duration-200 font-medium hover:shadow-sm border border-red-200 text-sm md:text-base",children:[(0,r.jsx)(A.A,{size:16,className:"md:hidden"}),(0,r.jsx)(A.A,{size:18,className:"hidden md:block"}),"ลบ"]})]})]}),(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,r.jsx)("div",{className:"p-4 md:p-6 border-b border-gray-100",children:(0,r.jsx)("h3",{className:"text-base md:text-lg font-semibold text-gray-900",children:"รายละเอียดงานสั่งทำ"})}),(0,r.jsx)("div",{className:"p-4 md:p-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-sm md:text-base font-medium text-gray-900 mb-3 flex items-center gap-2",children:[(0,r.jsx)(x.A,{className:"w-4 h-4 text-gray-600"}),"ข้อมูลลูกค้า"]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 gap-1 sm:gap-0",children:[(0,r.jsx)("span",{className:"text-xs md:text-sm text-gray-600",children:"ชื่อลูกค้า"}),(0,r.jsx)("span",{className:"text-sm md:text-sm font-medium text-gray-900 break-words",children:J.customerName})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 border-t border-gray-50 gap-1 sm:gap-0",children:[(0,r.jsx)("span",{className:"text-xs md:text-sm text-gray-600",children:"เบอร์โทรศัพท์"}),(0,r.jsx)("span",{className:"text-sm md:text-sm font-medium text-gray-900 font-mono",children:J.phoneNumber})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-sm md:text-base font-medium text-gray-900 mb-3 flex items-center gap-2",children:[(0,r.jsx)(u.A,{className:"w-4 h-4 text-gray-600"}),"ข้อมูลรถยนต์"]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 gap-1 sm:gap-0",children:[(0,r.jsx)("span",{className:"text-xs md:text-sm text-gray-600",children:"ประเภทรถ"}),(0,r.jsx)("span",{className:"text-sm md:text-sm font-medium text-gray-900 break-words",children:J.carType})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 border-t border-gray-50 gap-1 sm:gap-0",children:[(0,r.jsx)("span",{className:"text-xs md:text-sm text-gray-600",children:"เลขทะเบียน"}),(0,r.jsx)("span",{className:"text-sm md:text-sm font-mono font-bold text-gray-900 bg-gray-50 px-2 py-1 rounded inline-block",children:J.licensePlate})]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-sm md:text-base font-medium text-gray-900 mb-3 flex items-center gap-2",children:[(0,r.jsx)(b.A,{className:"w-4 h-4 text-gray-600"}),"รายละเอียดงาน"]}),(0,r.jsxs)("div",{className:"space-y-4",children:[J.issueDetail&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-2 uppercase tracking-wide",children:"ปัญหาที่พบ"}),(0,r.jsx)("p",{className:"text-xs md:text-sm text-gray-900 bg-gray-50 p-3 rounded border-l-4 border-gray-300 leading-relaxed break-words",children:J.issueDetail})]}),J.jobDetail&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-2 uppercase tracking-wide",children:"งานที่จะทำ"}),(0,r.jsx)("p",{className:"text-xs md:text-sm text-gray-900 bg-gray-50 p-3 rounded border-l-4 border-gray-300 leading-relaxed break-words",children:J.jobDetail})]}),!J.issueDetail&&!J.jobDetail&&(0,r.jsx)("div",{className:"text-center py-6 md:py-8 text-gray-500",children:(0,r.jsx)("p",{className:"text-xs md:text-sm",children:"ไม่มีรายละเอียดเพิ่มเติม"})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-sm md:text-base font-medium text-gray-900 mb-3 flex items-center gap-2",children:[(0,r.jsx)(E.A,{className:"w-4 h-4 text-gray-600"}),"ข้อมูลเพิ่มเติม"]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 gap-1 sm:gap-0",children:[(0,r.jsx)("span",{className:"text-xs md:text-sm text-gray-600",children:"วันที่สร้าง"}),(0,r.jsx)("span",{className:"text-xs md:text-sm font-medium text-gray-900",children:new Date(J.createdAt).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 border-t border-gray-50 gap-1 sm:gap-0",children:[(0,r.jsx)("span",{className:"text-xs md:text-sm text-gray-600",children:"สาขา"}),(0,r.jsx)("span",{className:"text-xs md:text-sm font-medium text-gray-900 break-words",children:(null==(t=J.branch)?void 0:t.name)||"Main Branch"})]})]})]})]})]})})]})}),J.items&&J.items.length>0&&(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,r.jsx)("div",{className:"p-4 md:p-6 border-b border-gray-100",children:(0,r.jsx)("h3",{className:"text-base md:text-lg font-semibold text-gray-900",children:"รายการสินค้า"})}),(0,r.jsx)("div",{className:"block md:hidden",children:(0,r.jsx)("div",{className:"p-4 space-y-3",children:J.items.map(e=>(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-900 flex-1 pr-2",children:e.product.name}),(0,r.jsx)("span",{className:"text-sm font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded flex-shrink-0",children:e.qty})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-600 font-mono",children:["SKU: ",e.product.sku]})]},e.id))})}),(0,r.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"สินค้า"}),(0,r.jsx)("th",{className:"px-4 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),(0,r.jsx)("th",{className:"px-4 md:px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"จำนวน"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:J.items.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-4 md:px-6 py-4 text-sm text-gray-900",children:e.product.name}),(0,r.jsx)("td",{className:"px-4 md:px-6 py-4 text-sm text-gray-600 font-mono",children:e.product.sku}),(0,r.jsx)("td",{className:"px-4 md:px-6 py-4 text-center text-sm font-medium text-gray-900",children:e.qty})]},e.id))})]})})]}),h&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 animate-in fade-in duration-200 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg md:rounded-2xl p-6 md:p-8 max-w-md w-full shadow-2xl animate-in zoom-in-95 duration-200",children:[(0,r.jsx)("h3",{className:"text-lg md:text-xl font-semibold text-red-600 mb-3 md:mb-4",children:"ยืนยันการลบ"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6 md:mb-8 text-sm md:text-base",children:"คุณต้องการลบงานสั่งทำนี้หรือไม่? การดำเนินการนี้ไม่สามารถยกเลิกได้"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 md:gap-4",children:[(0,r.jsx)("button",{onClick:()=>g(!1),disabled:P,className:"flex-1 px-4 md:px-6 py-2 md:py-3 border border-gray-300 text-gray-700 rounded-lg md:rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50 font-medium text-sm md:text-base",children:"ยกเลิก"}),(0,r.jsx)("button",{onClick:R,disabled:P,className:"flex-1 px-4 md:px-6 py-2 md:py-3 bg-red-600 text-white rounded-lg md:rounded-xl hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2 font-medium text-sm md:text-base",children:P?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y,{className:"w-4 h-4 md:w-5 md:h-5 animate-spin"}),"กำลังลบ..."]}):"ลบ"})]})]})})]})}function S(e){let{lastRefreshTime:t,onCreateClick:s,onRefreshClick:a}=e;return(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"จัดการ Job Orders"}),(0,r.jsx)("p",{className:"text-gray-600",children:"สร้างและจัดการงานซ่อมรถยนต์ของลูกค้า"}),(0,r.jsx)("div",{className:"flex items-center gap-2 mt-2 text-sm text-gray-500",children:(0,r.jsxs)("span",{children:["อัปเดตล่าสุด: ",t.toLocaleTimeString("th-TH")]})})]}),(0,r.jsxs)("div",{className:"mt-4 lg:mt-0 flex gap-3",children:[(0,r.jsxs)("button",{className:"px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-medium flex items-center gap-2",onClick:a,title:"รีเฟรชข้อมูล",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"รีเฟรช"]}),(0,r.jsxs)("button",{className:"px-6 py-3 bg-orange-600 text-white rounded-xl hover:bg-orange-700 transition-colors font-medium flex items-center gap-2",onClick:s,children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"เพิ่ม Job Order ใหม่"]})]})]})})}function D(e){let{customer:t,consumers:s,onCustomerChange:a}=e;return(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:(0,r.jsx)("div",{className:"flex flex-col lg:flex-row gap-4",children:(0,r.jsxs)("div",{className:"lg:w-64",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"กรองตามลูกค้า"}),(0,r.jsxs)("select",{className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",value:t,onChange:e=>a(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"ทุกลูกค้า"}),s.map((e,t)=>(0,r.jsx)("option",{value:e,children:e},"customer-".concat(t,"-").concat(e)))]})]})})})}function P(e){let{title:t,count:s,description:a,gradientFrom:l,gradientTo:o,borderColor:n,bgColor:d,textColor:c,isAnimated:i=!1}=e;return(0,r.jsxs)("div",{className:"bg-gradient-to-r ".concat(l," ").concat(o," rounded-xl p-6 border ").concat(n),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-3 h-3 ".concat(d," rounded-full ").concat(i?"animate-pulse":"")}),(0,r.jsx)("h3",{className:"text-lg font-semibold ".concat(c),children:t})]}),(0,r.jsx)("p",{className:"text-3xl font-bold ".concat(c," mt-2"),children:s}),(0,r.jsx)("p",{className:"text-sm ".concat(c," mt-1 opacity-80"),children:a})]})}function M(e){let{groupedJobs:t}=e,s=e=>e.reduce((e,t)=>e+(t.grandTotal||0),0),a=s(t.PENDING),l=s(t.IN_PROGRESS),o=s(t.COMPLETED);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsx)(P,{title:"เปิดงาน",count:t.PENDING.length,description:"งานรอดำเนินการ",gradientFrom:"from-orange-50",gradientTo:"to-yellow-50",borderColor:"border-orange-200",bgColor:"bg-orange-500",textColor:"text-orange-800"}),(0,r.jsx)(P,{title:"กำลังดำเนินการ",count:t.IN_PROGRESS.length,description:"งานที่กำลังทำ",gradientFrom:"from-blue-50",gradientTo:"to-indigo-50",borderColor:"border-blue-200",bgColor:"bg-blue-500",textColor:"text-blue-800",isAnimated:!0}),(0,r.jsx)(P,{title:"เสร็จสิ้น",count:t.COMPLETED.length,description:"งานที่เสร็จแล้ว",gradientFrom:"from-green-50",gradientTo:"to-emerald-50",borderColor:"border-green-200",bgColor:"bg-green-500",textColor:"text-green-800"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"สรุปการเงิน"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-orange-600 mb-2",children:["฿",a.toLocaleString()]}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"ยอดรวมงานรอดำเนินการ"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold text-blue-600 mb-2",children:["฿",l.toLocaleString()]}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"ยอดรวมงานที่กำลังทำ"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-xl font-bold text-green-600 mb-2",children:["฿",o.toLocaleString()]}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"ยอดรวมงานที่เสร็จแล้ว"})]})]})]})]})}let J=(0,c.A)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);function T(e){let{job:t,onCardClick:s}=e,a=(e=>{switch(e){case"PENDING":case"OPEN":return{label:"เปิดงาน",color:"bg-orange-100 text-orange-800 border-orange-200",bgColor:"bg-orange-50"};case"IN_PROGRESS":return{label:"กำลังดำเนินการ",color:"bg-blue-100 text-blue-800 border-blue-200",bgColor:"bg-blue-50"};case"COMPLETED":return{label:"เสร็จสิ้น",color:"bg-green-100 text-green-800 border-green-200",bgColor:"bg-green-50"};default:return{label:e,color:"bg-gray-100 text-gray-800 border-gray-200",bgColor:"bg-gray-50"}}})(t.status);return(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-all duration-200 cursor-pointer hover:border-gray-300",onClick:()=>s(t),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-1 truncate",children:["#",t.jobNumber]}),(0,r.jsx)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ".concat(a.color),children:a.label})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 text-right ml-2",children:new Date(t.createdAt).toLocaleDateString("th-TH",{month:"short",day:"numeric"})})]}),(0,r.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:t.customerName})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:t.phoneNumber})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:t.carType})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:t.licensePlate})]})]}),(0,r.jsxs)("div",{className:"pt-4 border-t border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"คลิกเพื่อดูรายละเอียด"}),(0,r.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)(J,{className:"w-4 h-4"})})]}),t.grandTotal&&(0,r.jsx)("div",{className:"pt-2 border-t border-gray-100",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"ยอดรวม:"}),(0,r.jsxs)("span",{className:"text-sm font-bold text-green-600",children:["฿",t.grandTotal.toLocaleString()]})]})})]})]})}function L(e){let{title:t,description:s,jobs:a,onCardClick:l,emptyMessage:o,emptySubMessage:n,gradientFrom:d,gradientTo:c,borderColor:i,bgColor:m,textColor:x,icon:h}=e;return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 w-1 h-full bg-gradient-to-b ".concat(d," ").concat(c," rounded-full")}),(0,r.jsxs)("div",{className:"ml-8 bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r ".concat(d," ").concat(c," border-b ").concat(i," px-6 py-5"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-5 h-5 ".concat(m," rounded-full shadow-sm")}),(0,r.jsx)("h2",{className:"text-2xl font-bold ".concat(x),children:t}),(0,r.jsxs)("span",{className:"".concat(m," text-white px-4 py-2 rounded-full text-sm font-semibold"),children:[a.length," งาน"]})]}),(0,r.jsx)("p",{className:"".concat(x," mt-2 ml-9"),children:s})]}),(0,r.jsx)("div",{className:"p-8 ".concat(m,"/20"),children:a.length>0?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(e=>(0,r.jsx)(T,{job:e,onCardClick:l},e.id))}):(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:h}),(0,r.jsx)("p",{className:"".concat(x," font-medium"),children:o}),(0,r.jsx)("p",{className:"".concat(x," text-sm mt-1 opacity-80"),children:n})]})})]})]})}function z(e){let{groupedJobs:t,onCardClick:s}=e;return(0,r.jsxs)("div",{className:"space-y-10",children:[(0,r.jsx)(L,{title:"เปิดงาน",description:"งานที่รอการดำเนินการ",jobs:t.PENDING,onCardClick:s,emptyMessage:"ไม่มีงานรอดำเนินการ",emptySubMessage:"งานใหม่จะปรากฏที่นี่",gradientFrom:"from-orange-50",gradientTo:"to-orange-500",borderColor:"border-orange-200",bgColor:"bg-orange-500",textColor:"text-orange-800",icon:"\uD83C\uDFCE️"}),(0,r.jsx)(L,{title:"กำลังดำเนินการ",description:"งานที่เริ่มแล้ว",jobs:t.IN_PROGRESS,onCardClick:s,emptyMessage:"ไม่มีงานที่กำลังดำเนินการ",emptySubMessage:"งานที่เริ่มแล้วจะปรากฏที่นี่",gradientFrom:"from-blue-50",gradientTo:"to-blue-500",borderColor:"border-blue-200",bgColor:"bg-blue-500",textColor:"text-blue-800",icon:"⚙️"}),(0,r.jsx)(L,{title:"เสร็จสิ้น",description:"งานที่ดำเนินการเสร็จสิ้นแล้ว",jobs:t.COMPLETED,onCardClick:s,emptyMessage:"ยังไม่มีงานที่เสร็จสิ้น",emptySubMessage:"งานที่เสร็จแล้วจะปรากฏที่นี่",gradientFrom:"from-green-50",gradientTo:"to-green-500",borderColor:"border-green-200",bgColor:"bg-green-500",textColor:"text-green-800",icon:"✅"})]})}function F(){return(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"กำลังโหลดข้อมูล..."})]})})}function I(){return(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,r.jsx)("p",{className:"text-gray-500 text-lg",children:"ไม่พบ Job Orders"}),(0,r.jsx)("p",{className:"text-gray-400",children:"ลองสร้าง Job Order ใหม่หรือเปลี่ยนตัวกรอง"})]})})}var R=s(5231),G=s(6769);function q(){let{user:e}=(0,l.A)(),[t,s]=(0,a.useState)([]),[n,d]=(0,a.useState)([]),[c,i]=(0,a.useState)(!1),[m,x]=(0,a.useState)(""),[h,u]=(0,a.useState)(!1),[g,b]=(0,a.useState)(null),[p,y]=(0,a.useState)(!1),[f,N]=(0,a.useState)(new Date),v=(0,a.useMemo)(()=>{console.log("\uD83D\uDD0D Grouping jobs - items:",t),console.log("\uD83D\uDD0D Items statuses:",t.map(e=>({id:e.id,status:e.status,jobNumber:e.jobNumber})));let e={PENDING:t.filter(e=>"PENDING"===e.status||"OPEN"===e.status),IN_PROGRESS:t.filter(e=>"IN_PROGRESS"===e.status),COMPLETED:t.filter(e=>"COMPLETED"===e.status)};return console.log("\uD83D\uDD0D Grouped results:",{PENDING:e.PENDING.length,IN_PROGRESS:e.IN_PROGRESS.length,COMPLETED:e.COMPLETED.length}),e},[t]);async function w(){try{var e;let t=await fetch("".concat("http://localhost:5001","/job-orders/consumers"),{credentials:"include"});if(!t.ok)throw Error("Failed to fetch consumers");let s=await t.json();d(null!=(e=s.consumers)?e:[])}catch(e){console.error("Error fetching consumers:",e)}}async function k(){try{i(!0);let e=new URLSearchParams;m&&e.set("customer",m),console.log("\uD83D\uDD0D Fetching job orders with params:",e.toString()),console.log("\uD83D\uDD0D API URL:","".concat("http://localhost:5001","/job-orders?").concat(e.toString()));let t=await fetch("".concat("http://localhost:5001","/job-orders?").concat(e.toString()),{credentials:"include"});if(console.log("\uD83D\uDD0D Response status:",t.status),console.log("\uD83D\uDD0D Response headers:",Object.fromEntries(t.headers.entries())),!t.ok){let e=await t.text();throw console.error("\uD83D\uDD0D Response not OK:",e),Error("Failed to fetch job orders: ".concat(t.status," ").concat(e))}let r=await t.json();console.log("\uD83D\uDD0D Received data:",r),console.log("\uD83D\uDD0D Data length:",(null==r?void 0:r.length)||0),s(r||[]),N(new Date),console.log("\uD83D\uDD0D Items state updated:",(null==r?void 0:r.length)||0,"items"),console.log("\uD83D\uDD0D Last refresh time updated:",new Date().toLocaleTimeString())}catch(e){console.error("\uD83D\uDD0D Error fetching job orders:",e)}finally{i(!1)}}async function C(e){try{let t=await fetch("".concat("http://localhost:5001","/job-orders"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.message||"Create failed")}u(!1),await k(),await w()}catch(e){console.error("Error creating job order:",e),alert(e instanceof Error?e.message:"Create failed")}}async function A(e,t){try{console.log("\uD83D\uDD0D JobOrdersPage: updateJobOrder called with:",{id:e,data:t}),console.log("\uD83D\uDD0D JobOrdersPage: Data type:",typeof t),console.log("\uD83D\uDD0D JobOrdersPage: Data keys:",Object.keys(t));let s=await fetch("".concat("http://localhost:5001","/job-orders/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(console.log("\uD83D\uDD0D JobOrdersPage: Update response status:",s.status),console.log("\uD83D\uDD0D JobOrdersPage: Response headers:",Object.fromEntries(s.headers.entries())),!s.ok){let e=await s.json();throw console.error("\uD83D\uDD0D JobOrdersPage: Update API Error:",e),Error(e.message||"Update failed")}let r=await s.json();console.log("\uD83D\uDD0D JobOrdersPage: Update successful:",r),await k(),await w(),b(null),y(!0)}catch(e){console.error("\uD83D\uDD0D JobOrdersPage: Error updating job order:",e),alert(e instanceof Error?e.message:"Update failed")}}async function E(e){if(confirm("ยืนยันการลบ Job Order นี้?"))try{let t=await fetch("".concat("http://localhost:5001","/job-orders/").concat(e),{method:"DELETE",credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.message||"Delete failed")}await k(),await w()}catch(e){console.error("Error deleting job order:",e),alert(e instanceof Error?e.message:"Delete failed")}}async function P(e){try{console.log("Fetching job order detail for ID:",e.id);let t=await fetch("".concat("http://localhost:5001","/job-orders/").concat(e.id),{credentials:"include"});if(console.log("Response status:",t.status),!t.ok){let e=await t.json();throw console.error("API Error:",e),Error("Failed to fetch job order detail")}let s=await t.json();console.log("Job order detail data:",s),b(s)}catch(e){console.error("Error fetching job order detail:",e),alert("ไม่สามารถดึงข้อมูลรายละเอียดได้")}}return(0,a.useEffect)(()=>{w()},[]),(0,a.useEffect)(()=>{console.log("\uD83D\uDD0D useEffect triggered - customer changed:",m),k()},[m]),(0,a.useEffect)(()=>{console.log("\uD83D\uDD0D Setting up auto-refresh every 5 minutes...");let e=setInterval(()=>{console.log("\uD83D\uDD0D Auto-refresh triggered (5 minutes)"),k()},3e5);return()=>{console.log("\uD83D\uDD0D Cleaning up auto-refresh interval"),clearInterval(e)}},[]),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(S,{lastRefreshTime:f,onCreateClick:()=>u(!0),onRefreshClick:()=>{console.log("\uD83D\uDD0D Manual refresh triggered"),k()}}),(0,r.jsx)(D,{customer:m,consumers:n,onCustomerChange:x}),!c&&t.length>0&&(0,r.jsx)(M,{groupedJobs:v}),c?(0,r.jsx)(F,{}):0===t.length?(0,r.jsx)(I,{}):(0,r.jsx)(z,{groupedJobs:v,onCardClick:P}),h&&(0,r.jsx)(o.A,{open:h,onClose:()=>u(!1),children:(0,r.jsx)(j,{mode:"create",onSubmit:C,onCancel:()=>u(!1)})}),g&&(0,r.jsx)(o.A,{open:!!g,onClose:()=>b(null),size:"xl",children:(0,r.jsx)(O,{jobOrder:g,onEdit:e=>A(g.id,e),onDelete:()=>E(g.id),onClose:()=>b(null)})}),(0,r.jsx)(R.A,{open:p,autoHideDuration:6e3,onClose:()=>y(!1),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,r.jsx)(G.A,{onClose:()=>y(!1),severity:"success",variant:"filled",sx:{width:"100%"},children:"อัปเดตข้อมูลงานสั่งทำเรียบร้อยแล้ว!"})})]})}},4416:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5339:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6440:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var r=s(5155),a=s(2115),l=s(4416);function o(e){let{open:t,title:s,onClose:o,children:n,size:d="md"}=e;return((0,a.useEffect)(()=>{function e(e){"Escape"===e.key&&o()}return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,o]),t)?(0,r.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity duration-300",onClick:o}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"w-full ".concat({sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-7xl"}[d]," bg-white rounded-2xl shadow-2xl border border-gray-200 transform transition-all duration-300 scale-100 opacity-100"),style:{maxHeight:"90vh",overflow:"hidden"},children:[s&&(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:s}),(0,r.jsx)("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(l.A,{size:20})})]}),(0,r.jsx)("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 80px)"},children:n})]})})]}):null}},7163:(e,t,s)=>{Promise.resolve().then(s.bind(s,4382))},7434:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},7930:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]])},8136:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},8313:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]])},9074:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},9420:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(9946).A)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])}},e=>{e.O(0,[81,441,964,358],()=>e(e.s=7163)),_N_E=e.O()}]);