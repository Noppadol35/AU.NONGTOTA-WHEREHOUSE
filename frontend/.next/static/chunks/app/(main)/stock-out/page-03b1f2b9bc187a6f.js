(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[511],{232:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9946).A)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},283:(e,s,t)=>{"use strict";t.d(s,{A:()=>c,AuthProvider:()=>i});var r=t(5155),l=t(2115),a=t(5695);let n=(0,l.createContext)(void 0),c=()=>{let e=(0,l.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},i=e=>{let{children:s}=e,[t,c]=(0,l.useState)(null),[i,o]=(0,l.useState)(!0),d=(0,a.useRouter)(),x=async()=>{try{let e=await fetch("".concat("http://localhost:5001","/auth/me"),{credentials:"include"});if(e.ok){let s=await e.json();c(s.user)}else c(null)}catch(e){console.error("Auth check failed:",e),c(null)}finally{o(!1)}},m=async(e,s,t)=>{let r=await fetch("".concat("http://localhost:5001","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:s,rememberMe:t})});if(!r.ok)throw Error((await r.json()).message||"Login failed");c((await r.json()).user),d.push("/dashboard")},h=async()=>{try{await fetch("".concat("http://localhost:5001","/auth/logout"),{method:"POST",credentials:"include"})}catch(e){console.error("Logout failed:",e)}finally{c(null),d.push("/login")}};return(0,l.useEffect)(()=>{x()},[]),(0,r.jsx)(n.Provider,{value:{user:t,loading:i,login:m,logout:h,checkAuth:x},children:s})}},1007:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9946).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},1543:(e,s,t)=>{Promise.resolve().then(t.bind(t,2583))},2583:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>C});var r=t(5155),l=t(2115),a=t(283),n=t(9946);let c=(0,n.A)("clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);function i(e){let{selectedJobId:s,onJobSelect:t}=e,[a,n]=(0,l.useState)([]),[i,o]=(0,l.useState)([]),[d,x]=(0,l.useState)(""),[m,h]=(0,l.useState)(!1),[u,g]=(0,l.useState)(null);async function j(){h(!0);try{console.log("Fetching job orders...");let e=await fetch("".concat("http://localhost:5001","/job-orders"),{credentials:"include"});if(console.log("Job orders response status:",e.status),!e.ok){let s=await e.json();throw console.error("Job orders API error:",s),Error("Failed to fetch job orders")}let s=await e.json();console.log("Fetched job orders:",s),Array.isArray(s)?n(s):(console.error("Invalid job orders data format:",s),n([]),g("ข้อมูลรายการงานไม่ถูกต้อง"))}catch(e){console.error("Failed to fetch job orders:",e),n([]),g("ไม่สามารถโหลดรายการงานได้")}finally{h(!1)}}async function b(){try{console.log("Fetching customers...");let e=await fetch("".concat("http://localhost:5001","/job-orders/consumers"),{credentials:"include"});if(console.log("Customers response status:",e.status),!e.ok){let s=await e.json();throw console.error("Customers API error:",s),Error("Failed to fetch customers")}let s=await e.json();console.log("Fetched customers:",s),Array.isArray(s.consumers)?o(s.consumers):(console.error("Invalid customers data format:",s),o([]),g("ข้อมูลลูกค้าไม่ถูกต้อง"))}catch(e){console.error("Failed to fetch customers:",e),o([]),g("ไม่สามารถโหลดรายชื่อลูกค้าได้")}}(0,l.useEffect)(()=>{j(),b()},[]);let p=a.filter(e=>!d||e.customerName===d);return console.log("JobOrderSelector Debug:",{jobOrders:a.length,customers:i.length,selectedCustomer:d,filteredJobOrders:p.length,availableJobs:p.filter(e=>"OPEN"===e.status||"IN_PROGRESS"===e.status).length}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)(c,{})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"เลือกงานที่ต้องการเบิกสินค้า"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"กรุณาเลือกงานที่ต้องการเบิกสินค้าจากคลัง"})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"กรองตามลูกค้า"}),(0,r.jsxs)("select",{value:d,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors bg-white",children:[(0,r.jsx)("option",{value:"",children:"ทุกลูกค้า"}),Array.isArray(i)&&i.map((e,s)=>(0,r.jsx)("option",{value:e,children:e},"customer-".concat(s,"-").concat(e)))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"เลือกงาน"}),(0,r.jsxs)("select",{value:s||"",onChange:e=>t(e.target.value?parseInt(e.target.value):null),className:"w-full px-4 py-3 border border-gray-300 text-gray-700 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors bg-white",disabled:m,children:[(0,r.jsx)("option",{value:"",children:"-- เลือกงาน --"}),Array.isArray(p)&&p.filter(e=>"OPEN"===e.status||"IN_PROGRESS"===e.status).map(e=>(0,r.jsxs)("option",{value:e.id,children:["Job #",e.jobNumber," - ",e.customerName," (",e.carType,")"]},e.id))]})]}),u&&(0,r.jsx)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-xl",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-red-700",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),u]})}),m&&(0,r.jsx)("div",{className:"mt-4 text-center",children:(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 text-sm text-gray-600",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-600"}),"กำลังโหลดข้อมูล..."]})}),!m&&Array.isArray(p)&&0===p.length&&(0,r.jsxs)("div",{className:"mt-6 text-center py-8",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"ไม่พบงานที่สามารถเบิกสินค้าได้"}),(0,r.jsx)("p",{className:"text-gray-400 text-xs",children:"ตรวจสอบสถานะงานหรือตัวกรองลูกค้า"})]}),Array.isArray(p)&&p.length>0&&(0,r.jsxs)("div",{className:"mt-4 text-sm text-gray-600",children:["พบงานทั้งหมด ",p.filter(e=>"OPEN"===e.status||"IN_PROGRESS"===e.status).length," รายการ"]})]})}var o=t(1007),d=t(9420),x=t(7930),m=t(232),h=t(2525);function u(e){let{jobOrder:s,onItemDelete:t}=e,[a,n]=(0,l.useState)(null);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-xl font-bold text-gray-900",children:["รายละเอียดงาน #",s.jobNumber]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"ข้อมูลงานและประวัติการเบิกสินค้า"})]}),(0,r.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat((e=>{switch(e){case"COMPLETED":return"bg-green-100 text-green-800";case"IN_PROGRESS":return"bg-blue-100 text-blue-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(s.status)),children:(e=>{switch(e){case"COMPLETED":return"เสร็จสิ้น";case"IN_PROGRESS":return"กำลังดำเนินการ";case"CANCELLED":return"ยกเลิก";case"OPEN":return"เปิดงาน";default:return e}})(s.status)})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)(o.A,{})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"ลูกค้า"}),(0,r.jsx)("p",{className:"font-semibold text-gray-900",children:s.customerName})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)(d.A,{})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"เบอร์โทร"}),(0,r.jsx)("p",{className:"font-semibold text-gray-900",children:s.phoneNumber})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)(x.A,{})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"ประเภทรถ"}),(0,r.jsx)("p",{className:"font-semibold text-gray-900",children:s.carType})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)(m.A,{})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"ทะเบียน"}),(0,r.jsx)("p",{className:"font-semibold text-gray-900",children:s.licensePlate})]})]})]})]}),(s.issueDetail||s.jobDetail)&&(0,r.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-xl",children:[s.issueDetail&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"อาการเสีย:"}),(0,r.jsx)("p",{className:"text-gray-900",children:s.issueDetail})]}),s.jobDetail&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"รายละเอียดงาน:"}),(0,r.jsx)("p",{className:"text-gray-900",children:s.jobDetail})]})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mb-6",children:["สร้างเมื่อ: ",new Date(s.createdAt).toLocaleString("th-TH")]}),s.items&&s.items.length>0&&(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),(0,r.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"ประวัติการเบิกสินค้า"})]}),(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ชื่อสินค้า"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"จำนวน"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-16",children:"จัดการ"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200",children:s.items.map(e=>{var s,t;return(0,r.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,r.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:(null==(s=e.product)?void 0:s.sku)||"-"}),(0,r.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:(null==(t=e.product)?void 0:t.name)||"-"}),(0,r.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:(0,r.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.qty," ชิ้น"]})}),(0,r.jsx)("td",{className:"px-4 py-3 text-right",children:(0,r.jsx)("button",{className:"p-2 rounded-lg hover:bg-red-100 transition-colors group",onClick:()=>{var s;return n({itemId:e.id,name:(null==(s=e.product)?void 0:s.name)||"-"})},"aria-label":"ลบรายการนี้",children:(0,r.jsx)(h.A,{size:16,className:"text-red-600 group-hover:text-red-700"})})})]},e.id)})})]})})})]}),(!s.items||0===s.items.length)&&(0,r.jsx)("div",{className:"border-t border-gray-200 pt-6",children:(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"ยังไม่มีประวัติการเบิกสินค้า"}),(0,r.jsx)("p",{className:"text-gray-400 text-xs",children:"สินค้าที่เบิกจะแสดงที่นี่"})]})})]}),a&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded shadow-lg max-w-sm w-full p-4",children:[(0,r.jsx)("div",{className:"font-semibold text-gray-900 mb-2",children:"ยืนยันการลบ"}),(0,r.jsxs)("p",{className:"text-sm text-gray-700 mb-4",children:["ต้องการลบ “",a.name,"” ออกจากประวัติการเบิกหรือไม่? สต็อกจะถูกคืนกลับอัตโนมัติ"]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{className:"px-3 py-2 border rounded",onClick:()=>n(null),children:"ยกเลิก"}),(0,r.jsx)("button",{className:"px-3 py-2 bg-red-600 text-white rounded",onClick:async()=>{try{await t(a.itemId),n(null)}catch(e){console.error("Failed to delete item:",e)}},children:"ลบรายการ"})]})]})})]})}let g=(0,n.A)("package-search",[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["circle",{cx:"18.5",cy:"15.5",r:"2.5",key:"b5zd12"}],["path",{d:"M20.27 17.27 22 19",key:"1l4muz"}]]),j=(0,n.A)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);function b(e){let{jobOrderId:s,onIssueItems:t,loading:a,onRefreshJobOrder:n}=e,[c,i]=(0,l.useState)(""),[o,d]=(0,l.useState)([]),[x,m]=(0,l.useState)([]),[u,b]=(0,l.useState)(!1),p=(0,l.useRef)(void 0);async function y(e){try{let s=await fetch("".concat("http://localhost:5001","/products?search=").concat(encodeURIComponent(e)),{credentials:"include"});if(!s.ok)throw Error("Failed to fetch products");let t=((await s.json()).items||[]).filter(s=>{let t=e.toLowerCase();return s.name.toLowerCase().includes(t)||s.sku.toLowerCase().includes(t)});d(t)}catch(e){console.error("Failed to fetch products:",e),d([])}}let f=(0,l.useCallback)(e=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{e.length>0?y(e):d([])},300)},[]);function v(e){m(s=>s.filter(s=>s.productId!==e))}async function N(){if(0!==x.length)try{b(!0);let e=setTimeout(()=>{b(!1)},3e3);await t(x),m([]),i(""),d([]),n(),clearTimeout(e),b(!1)}catch(e){console.error("Failed to issue items:",e),b(!1)}}return(0,l.useEffect)(()=>(f(c),()=>{p.current&&clearTimeout(p.current)}),[c,f]),s?(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)(g,{})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"ค้นหาและเบิกสินค้า"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"ค้นหาสินค้าและทำการเบิกออกจากคลัง"})]})]}),s?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ค้นหาสินค้า"}),(0,r.jsxs)("div",{className:"relative text-gray-700",children:[(0,r.jsx)("input",{type:"text",value:c,onChange:function(e){i(e.target.value)},placeholder:"พิมพ์ชื่อสินค้าหรือ SKU...",className:"w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors"}),(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),c&&(0,r.jsx)("button",{onClick:()=>i(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-gray-400 hover:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.length>0&&(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["ผลการค้นหา (",o.length,")"]}),(0,r.jsx)("button",{onClick:()=>d([]),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"ปิดผลการค้นหา",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:o.map(e=>{let s=x.some(s=>s.productId===e.id);return(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0 ".concat(s?"bg-green-50 border-green-200":""),children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600",children:[(0,r.jsxs)("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:["SKU: ",e.sku]}),(0,r.jsxs)("span",{children:["คงเหลือ: ",e.stockQuantity," ชิ้น"]}),(0,r.jsxs)("span",{className:"font-medium text-green-600",children:["฿",e.sellPrice.toLocaleString()]}),s&&(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"เพิ่มแล้ว"})]})]}),(0,r.jsx)("button",{onClick:()=>{x.find(s=>s.productId===e.id)?m(s=>s.map(s=>s.productId===e.id?{...s,qty:s.qty+1}:s)):m(s=>[...s,{productId:e.id,qty:1,product:e}])},disabled:s,className:"ml-4 p-2 rounded-lg transition-colors ".concat(s?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-green-100 text-green-700 hover:bg-green-200"),title:s?"เพิ่มแล้ว":"เพิ่มสินค้า",children:(0,r.jsx)(j,{size:20})})]},e.id)})})]}),x.length>0&&(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:[(0,r.jsx)("div",{className:"px-4 py-3 bg-blue-50 border-b border-blue-200",children:(0,r.jsxs)("h3",{className:"text-sm font-medium text-blue-700",children:["สินค้าที่จะเบิก (",x.length,")"]})}),(0,r.jsx)("div",{className:"p-4 space-y-3",children:x.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.product.name}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-600",children:[(0,r.jsxs)("span",{className:"font-mono bg-white px-2 py-1 rounded text-xs",children:["SKU: ",e.product.sku]}),(0,r.jsxs)("span",{children:["คงเหลือ: ",e.product.stockQuantity," ชิ้น"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-gray-700",children:[(0,r.jsx)("input",{type:"number",min:"1",max:e.product.stockQuantity,value:e.qty,onChange:s=>(function(e,s){if(s<=0)return void v(e);m(t=>t.map(t=>t.productId===e?{...t,qty:s}:t))})(e.productId,parseInt(s.target.value)||1),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,r.jsx)("button",{onClick:()=>v(e.productId),className:"p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",title:"ลบสินค้า",children:(0,r.jsx)(h.A,{size:16})})]})]},e.productId))}),(0,r.jsx)("div",{className:"px-4 py-4 bg-gray-50 border-t border-gray-200",children:(0,r.jsx)("button",{onClick:N,disabled:a,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium flex items-center justify-center gap-2",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"กำลังประมวลผล..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"เบิกสินค้า (",x.reduce((e,s)=>e+s.qty,0)," ชิ้น)"]})})})]}),c&&0===o.length&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"ไม่พบสินค้าที่ค้นหา"}),(0,r.jsx)("p",{className:"text-gray-400 text-xs",children:"ลองเปลี่ยนคำค้นหาหรือตรวจสอบ SKU"})]})]}):(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"กรุณาเลือกงานก่อน"}),(0,r.jsx)("p",{className:"text-gray-400 text-xs",children:"เลือกงานที่ต้องการเบิกสินค้าจากด้านบน"})]}),u&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-8 shadow-2xl flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600"})}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"กำลังเบิกสินค้า..."}),(0,r.jsxs)("p",{className:"text-gray-600 text-center",children:["กรุณารอสักครู่ ระบบกำลังประมวลผล",(0,r.jsx)("br",{}),"การเบิกสินค้าจำนวน ",x.reduce((e,s)=>e+s.qty,0)," ชิ้น"]})]})})]}):null}var p=t(5231),y=t(6769),f=t(7515);let v=(0,f.A)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),N=(0,f.A)((0,r.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),w=(0,f.A)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error");function k(e){let{open:s,type:t,message:a,onClose:n}=e,[c,i]=(0,l.useState)(null);return console.log("\uD83C\uDFAD AlertBox render:",{open:s,type:t,message:a,autoHideDuration:c}),(0,l.useEffect)(()=>{if(console.log("\uD83C\uDFAD AlertBox useEffect triggered:",{open:s,type:t}),s)switch(t){case"success":i(2e3);break;case"warning":i(3e3);break;case"error":i(null)}},[s,t]),(0,r.jsx)(p.A,{open:s,autoHideDuration:c,onClose:n,anchorOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiSnackbar-root":{top:24,right:24}},children:(0,r.jsx)(y.A,{onClose:n,...(()=>{switch(t){case"success":return{severity:"success",icon:(0,r.jsx)(v,{}),sx:{backgroundColor:"#4caf50",color:"white","& .MuiAlert-icon":{color:"white"}}};case"warning":return{severity:"warning",icon:(0,r.jsx)(N,{}),sx:{backgroundColor:"#ff9800",color:"white","& .MuiAlert-icon":{color:"white"}}};case"error":return{severity:"error",icon:(0,r.jsx)(w,{}),sx:{backgroundColor:"#f44336",color:"white","& .MuiAlert-icon":{color:"white"}}}}})(),variant:"filled",elevation:6,children:a})})}function C(){var e;let{user:s}=(0,a.A)(),[t,n]=(0,l.useState)(null),[c,o]=(0,l.useState)(null),[d,x]=(0,l.useState)(null),[m,h]=(0,l.useState)(!1),[g,j]=(0,l.useState)(!1),[p,y]=(0,l.useState)("success"),[f,v]=(0,l.useState)("");async function N(e){try{let s=await fetch("".concat("http://localhost:5001","/job-orders/").concat(e),{credentials:"include"});if(!s.ok)throw Error("Failed to fetch job order detail");let t=await s.json();console.log("Fetched job order detail:",t),o(t)}catch(e){console.error("Failed to fetch job order detail:",e),w("error","ไม่สามารถดึงข้อมูล Job Order ได้")}}(0,l.useEffect)(()=>{t?N(t):(o(null),x(null))},[t]);let w=(e,s)=>{console.log("\uD83C\uDFAF showAlert called with:",{type:e,message:s}),y(e),v(s),j(!0),console.log("\uD83C\uDFAF Alert state set:",{type:e,message:s,open:!0})};async function C(e){if(t)try{var s;h(!0);let r=await fetch("".concat("http://localhost:5001","/job-orders/").concat(t,"/stock-out"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({items:e})});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to issue items")}let l=await r.json();console.log("Stock out result:",l),l.jobOrder&&o(l.jobOrder),x({jobNumber:(null==(s=l.jobOrder)?void 0:s.jobNumber)||(null==c?void 0:c.jobNumber)||"",items:l.issuedProducts||[]}),w("success","ออกสินค้าสำเร็จแล้ว"),await N(t)}catch(e){console.error("Failed to issue items:",e),w("error",e instanceof Error?e.message:"ไม่สามารถออกสินค้าได้")}finally{h(!1)}}async function A(e){if(t)try{let s=await fetch("".concat("http://localhost:5001","/job-orders/").concat(t,"/items/").concat(e),{method:"DELETE",credentials:"include"});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to delete item")}await N(t),w("success","ลบรายการสำเร็จ")}catch(e){w("error",e instanceof Error?e.message:"Failed to delete item")}}return s?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 space-y-6 p-6",children:[(0,r.jsx)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"ระบบเบิกสินค้า"}),(0,r.jsx)("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"เลือกงานที่ต้องการเบิกสินค้าและทำการเบิกใช้สินค้าจากคลัง"})]})}),(0,r.jsx)(k,{open:g,type:p,message:f,onClose:()=>{j(!1)}}),(0,r.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 sm:gap-6",children:[(0,r.jsxs)("div",{className:"xl:col-span-2 space-y-4 sm:space-y-6",children:[(0,r.jsx)("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:(0,r.jsx)(i,{selectedJobId:t,onJobSelect:n})}),(0,r.jsx)("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:(0,r.jsx)(b,{jobOrderId:t,onIssueItems:C,loading:m,onRefreshJobOrder:()=>t&&N(t)})})]}),(0,r.jsx)("div",{className:"xl:col-span-1",children:(0,r.jsxs)("div",{className:"sticky top-20 space-y-4 sm:space-y-6",children:[d&&(0,r.jsxs)("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-gray-200 p-4 sm:p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 text-sm sm:text-base",children:"รายการเบิกล่าสุด"}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-gray-600",children:["Job #",d.jobNumber]})]})]}),(0,r.jsx)("div",{className:"space-y-3",children:d.items.map(e=>{var s,t;return(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 text-sm truncate",children:(null==(s=e.product)?void 0:s.name)||"Product ID: ".concat(e.productId)}),(0,r.jsx)("p",{className:"text-xs text-gray-500 truncate",children:null==(t=e.product)?void 0:t.sku})]}),(0,r.jsxs)("div",{className:"text-right ml-2",children:[(0,r.jsxs)("p",{className:"font-semibold text-gray-900 text-sm",children:[e.qtyIssued," ชิ้น"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["เหลือ: ",e.remainingStock]})]})]},"".concat(e.productId,"-").concat(e.qtyIssued,"-").concat(e.remainingStock))})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-gray-200 p-4 sm:p-6",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-4 text-sm sm:text-base",children:"สถิติการเบิกสินค้า"}),(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-xs sm:text-sm text-gray-600",children:"งานที่เลือก"}),(0,r.jsx)("span",{className:"font-semibold text-gray-900 text-xs sm:text-sm",children:c?"Job #".concat(c.jobNumber):"ยังไม่ได้เลือก"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-xs sm:text-sm text-gray-600",children:"สถานะ"}),(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((null==c?void 0:c.status)==="COMPLETED"?"bg-green-100 text-green-800":(null==c?void 0:c.status)==="IN_PROGRESS"?"bg-blue-100 text-blue-800":(null==c?void 0:c.status)==="CANCELLED"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:(null==c?void 0:c.status)==="COMPLETED"?"เสร็จสิ้น":(null==c?void 0:c.status)==="IN_PROGRESS"?"กำลังดำเนินการ":(null==c?void 0:c.status)==="CANCELLED"?"ยกเลิก":(null==c?void 0:c.status)==="OPEN"?"เปิดงาน":"ไม่ทราบสถานะ"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-xs sm:text-sm text-gray-600",children:"จำนวนรายการ"}),(0,r.jsxs)("span",{className:"font-semibold text-gray-900 text-xs sm:text-sm",children:[(null==c||null==(e=c.items)?void 0:e.length)||0," รายการ"]})]})]})]}),c&&(0,r.jsx)("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:(0,r.jsx)(u,{jobOrder:c,onItemDelete:A})}),(0,r.jsx)("div",{className:"bg-blue-50 rounded-xl sm:rounded-2xl border border-blue-200 p-4 sm:p-6",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,r.jsx)("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-blue-900 mb-2 text-sm sm:text-base",children:"วิธีใช้งาน"}),(0,r.jsxs)("ol",{className:"text-xs sm:text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[(0,r.jsx)("li",{children:"เลือกงานที่ต้องการเบิกสินค้า"}),(0,r.jsx)("li",{children:"ค้นหาสินค้าที่ต้องการเบิก"}),(0,r.jsx)("li",{children:"ระบุจำนวนและกดเบิกสินค้า"}),(0,r.jsx)("li",{children:"ตรวจสอบรายการเบิกล่าสุด"})]})]})]})})]})})]}),m&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-8 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),(0,r.jsx)("p",{className:"text-gray-700 font-medium",children:"กำลังประมวลผล..."})]})})]}):(0,r.jsx)("div",{className:"text-center py-8",children:"กรุณาเข้าสู่ระบบ"})}},7930:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9946).A)("car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]])},9420:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(9946).A)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])}},e=>{e.O(0,[81,441,964,358],()=>e(e.s=1543)),_N_E=e.O()}]);