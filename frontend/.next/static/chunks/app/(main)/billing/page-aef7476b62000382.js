(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[991],{283:(e,s,t)=>{"use strict";t.d(s,{A:()=>c,AuthProvider:()=>d});var a=t(5155),r=t(2115),l=t(5695);let n=(0,r.createContext)(void 0),c=()=>{let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},d=e=>{let{children:s}=e,[t,c]=(0,r.useState)(null),[d,i]=(0,r.useState)(!0),o=(0,l.useRouter)(),x=async()=>{try{let e=await fetch("".concat("http://localhost:5001","/auth/me"),{credentials:"include"});if(e.ok){let s=await e.json();c(s.user)}else c(null)}catch(e){console.error("Auth check failed:",e),c(null)}finally{i(!1)}},m=async(e,s,t)=>{let a=await fetch("".concat("http://localhost:5001","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:e,password:s,rememberMe:t})});if(!a.ok)throw Error((await a.json()).message||"Login failed");c((await a.json()).user),o.push("/dashboard")},h=async()=>{try{await fetch("".concat("http://localhost:5001","/auth/logout"),{method:"POST",credentials:"include"})}catch(e){console.error("Logout failed:",e)}finally{c(null),o.push("/login")}};return(0,r.useEffect)(()=>{x()},[]),(0,a.jsx)(n.Provider,{value:{user:t,loading:d,login:m,logout:h,checkAuth:x},children:s})}},4122:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>E});var a=t(5155),r=t(2115),l=t(283),n=t(7434),c=t(6308),d=t(1304),i=t(1788);function o(e){let{onPrint:s,onDownload:t}=e;return(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4 lg:mb-0",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-600 rounded-xl flex items-center justify-center",children:(0,a.jsx)(c.A,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"ใบแจ้งหนี้ (Billing)"}),(0,a.jsx)("p",{className:"text-gray-600",children:"รายละเอียดงานและประวัติการเบิกสินค้า"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{onClick:s,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),"พิมพ์"]}),(0,a.jsxs)("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-orange-100 text-orange-700 rounded-lg hover:bg-orange-200 transition-colors",children:[(0,a.jsx)(i.A,{className:"w-4 h-4"}),"ดาวน์โหลด"]})]})]})})}function x(e){let{jobOrders:s,selectedJobOrderId:t,onJobOrderSelect:r}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(n.A,{className:"w-5 h-5 text-orange-600"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"เลือกงานสั่งทำ"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:'เลือกงานสั่งทำ (เฉพาะงานที่มีสถานะ "กำลังดำเนินการ")'}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("select",{value:t||"",onChange:e=>r(Number(e.target.value)||null),className:"w-full px-4 py-3 border text-gray-700 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors bg-white",children:[(0,a.jsx)("option",{value:"",children:"-- เลือกงานสั่งทำ --"}),s.map(e=>{var s,t;return(0,a.jsxs)("option",{value:e.id,children:[e.customerName," -"," ",(null==(s=e.issueDetail)?void 0:s.substring(0,50))||(null==(t=e.jobDetail)?void 0:t.substring(0,50))||e.carType||"ไม่มีรายละเอียด","..."]},e.id)})]})}),0===s.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(n.A,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:'ไม่มีงานสั่งทำที่มีสถานะ "กำลังดำเนินการ"'})]})]})]})}var m=t(1007),h=t(9420),g=t(8136),u=t(9074);function j(e){var s;let{jobOrder:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(n.A,{className:"w-5 h-5 text-orange-600"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"รายละเอียดงาน"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"ลูกค้า"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:t.customerName})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(h.A,{className:"w-5 h-5 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"เบอร์โทร"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:t.phoneNumber})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(n.A,{className:"w-5 h-5 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"เลขที่งาน"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:t.jobNumber})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(g.A,{className:"w-5 h-5 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"สาขา"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:(null==(s=t.branch)?void 0:s.name)||"ไม่ระบุ"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(u.A,{className:"w-5 h-5 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"วันที่สร้าง"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:new Date(t.createdAt).toLocaleDateString("th-TH")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(n.A,{className:"w-5 h-5 text-gray-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"ประเภทรถ"}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:t.carType})]})]})]})]}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"รายละเอียดงาน"}),(0,a.jsxs)("div",{className:"space-y-3",children:[t.issueDetail&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"รายละเอียดปัญหา:"}),(0,a.jsx)("p",{className:"text-gray-900 bg-gray-50 rounded-lg p-3",children:t.issueDetail})]}),t.jobDetail&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"รายละเอียดงาน:"}),(0,a.jsx)("p",{className:"text-gray-900 bg-gray-50 rounded-lg p-3",children:t.jobDetail})]})]})]})]})}var b=t(7108);function p(e){let{transactions:s}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(b.A,{className:"w-5 h-5 text-green-600"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"ประวัติการเบิกสินค้า"})]}),s&&0!==s.length?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500",children:"สินค้า"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500",children:"SKU"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500",children:"จำนวน"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500",children:"ราคาต่อหน่วย"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500",children:"รวม"})]})}),(0,a.jsx)("tbody",{children:s.map(e=>{var s,t,r,l;return(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("p",{className:"font-medium text-gray-900",children:(null==(s=e.product)?void 0:s.name)||"ไม่ระบุ"})}),(0,a.jsx)("td",{className:"py-3 px-4 text-sm text-gray-600",children:(null==(t=e.product)?void 0:t.sku)||"ไม่ระบุ"}),(0,a.jsx)("td",{className:"py-3 px-4 text-right text-gray-900",children:Math.abs(e.qtyChange)}),(0,a.jsxs)("td",{className:"py-3 px-4 text-right text-gray-900",children:["฿",((null==(r=e.product)?void 0:r.sellPrice)||0).toFixed(2)]}),(0,a.jsxs)("td",{className:"py-3 px-4 text-right font-medium text-gray-900",children:["฿",(((null==(l=e.product)?void 0:l.sellPrice)||0)*Math.abs(e.qtyChange)).toFixed(2)]})]},e.id)})})]})}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(b.A,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"ยังไม่มีประวัติการเบิกสินค้า"})]})]})}var y=t(5868),N=t(8313),f=t(1586),v=t(7939),w=t(232),A=t(6862),k=t(248),C=t.n(k);function P(e){let{amount:s}=e,[t,l]=(0,r.useState)(""),[n,c]=(0,r.useState)(""),d="0970626215";return((0,r.useEffect)(()=>{if(d&&s>0)try{let e=C()(d,{amount:s});A.toDataURL(e,{width:200,margin:2,color:{dark:"#000000",light:"#FFFFFF"}},(e,s)=>{e?(console.error("Error generating QR Code image:",e),c("ไม่สามารถสร้าง QR Code ได้"),l("")):(l(s),c(""))})}catch(e){console.error("Error generating PromptPay QR:",e),c("ไม่สามารถสร้าง QR Code ได้"),l("")}},[d,s]),n)?(0,a.jsxs)("div",{className:"text-center p-6 bg-gradient-to-br from-red-50 to-pink-50 rounded-2xl",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-red-500 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,a.jsx)(v.A,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h4",{className:"text-xl font-bold text-gray-900 mb-2",children:"เกิดข้อผิดพลาด"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"ไม่สามารถสร้าง QR Code ได้"})]}),(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 p-8 mb-6 inline-block",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("div",{className:"w-56 h-56 bg-red-50 rounded-xl mx-auto flex items-center justify-center border-2 border-dashed border-red-200",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(v.A,{className:"w-24 h-24 text-red-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-sm text-red-600 font-medium",children:n})]})})})}),(0,a.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100 max-w-sm mx-auto",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"กรุณาลองใหม่อีกครั้ง หรือติดต่อผู้ดูแลระบบ"}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:"ลองใหม่"})]})})]}):t?(0,a.jsxs)("div",{className:"text-center p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,a.jsx)(v.A,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h4",{className:"text-xl font-bold text-gray-900 mb-2",children:"PromptPay QR Code"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"สแกนเพื่อชำระเงิน"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 p-8 mb-6 inline-block",children:[(0,a.jsx)("div",{className:"bg-white rounded-xl p-4 border-2 border-dashed border-gray-200",children:(0,a.jsx)("img",{src:t,alt:"PromptPay QR Code",className:"w-56 h-56 mx-auto drop-shadow-lg"})}),(0,a.jsxs)("div",{className:"mt-4 text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-blue-600 mb-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"พร้อมสแกน"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"เปิด mobile banking app และสแกน QR Code"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100 max-w-sm mx-auto",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)(m.A,{})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"PromptPay ID"})]}),(0,a.jsx)("span",{className:"text-sm font-bold text-gray-900 font-mono",children:d})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)(y.A,{})})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"จำนวนเงิน"})]}),(0,a.jsxs)("span",{className:"text-lg font-bold text-green-700",children:["฿",s.toFixed(2)]})]})]}),(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-blue-700",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)(w.A,{})}),(0,a.jsx)("span",{className:"text-xs font-medium",children:"การชำระเงินปลอดภัย 100%"})]})})]})]}):(0,a.jsxs)("div",{className:"text-center p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg animate-pulse",children:(0,a.jsx)(v.A,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h4",{className:"text-xl font-bold text-gray-900 mb-2",children:"กำลังสร้าง QR Code"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"กรุณารอสักครู่..."})]}),(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 p-8 mb-6 inline-block",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"w-56 h-56 bg-gray-200 rounded-xl mx-auto flex items-center justify-center",children:(0,a.jsx)(v.A,{className:"w-24 h-24 text-gray-400"})}),(0,a.jsxs)("div",{className:"mt-4 text-center",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-32 mx-auto mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-gray-200 rounded w-48 mx-auto"})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-gray-100 max-w-sm mx-auto",children:(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-12 bg-gray-200 rounded-lg mb-4"}),(0,a.jsx)("div",{className:"h-12 bg-gray-200 rounded-lg"})]})})})]})}function S(e){let{transactions:s,totalAmount:t,selectedPaymentMethod:l,promptPayAmount:n,showQR:c,laborCost:d,onPaymentMethodChange:i,onPromptPayAmountChange:o,onLaborCostChange:x,onConfirmPayment:m}=e,[h,g]=(0,r.useState)(!1),u=t+d,j=.07*u,b=u+j;return(0,r.useEffect)(()=>{"promptpay"===l&&o(b)},[b,l,o]),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 sticky top-20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(y.A,{className:"w-5 h-5 text-orange-600"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"สรุปการชำระเงิน"})]}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"จำนวนรายการ"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:[(null==s?void 0:s.length)||0," รายการ"]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"รวมจำนวนสินค้า"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:[(null==s?void 0:s.reduce((e,s)=>e+Math.abs(s.qtyChange||0),0))||0," ","ชิ้น"]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"ยอดรวมสินค้า"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["฿",(t||0).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"ค่าแรงงาน"}),(0,a.jsx)("button",{onClick:()=>g(!0),className:"p-1 text-orange-600 hover:text-orange-700 hover:bg-orange-50 rounded transition-colors",title:"แก้ไขค่าแรงงาน",children:(0,a.jsx)(N.A,{className:"w-4 h-4"})})]}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["฿",d.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"รวมก่อน VAT"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["฿",u.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"VAT 7%"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["฿",j.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:"ยอดรวมทั้งหมด"}),(0,a.jsxs)("span",{className:"text-2xl font-bold text-orange-600",children:["฿",b.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"เลือกวิธีการชำระเงิน"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[(0,a.jsx)("input",{type:"radio",name:"paymentMethod",value:"cash",checked:"cash"===l,onChange:()=>i("cash"),className:"w-4 h-4 text-orange-600 focus:ring-orange-500"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.A,{className:"w-5 h-5 text-gray-600"}),(0,a.jsx)("span",{className:"text-gray-900",children:"เงินสด"})]})]}),(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[(0,a.jsx)("input",{type:"radio",name:"paymentMethod",value:"promptpay",checked:"promptpay"===l,onChange:()=>i("promptpay"),className:"w-4 h-4 text-orange-600 focus:ring-orange-500"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-gray-600"}),(0,a.jsx)("span",{className:"text-gray-900",children:"PromptPay QR"})]})]})]}),"promptpay"===l&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"จำนวนเงิน (PromptPay)"}),(0,a.jsx)("input",{type:"number",value:n||b,onChange:e=>o(Number(e.target.value)),className:"w-full px-3 py-2 border text-gray-700 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"0.00",step:"0.01",min:"0"}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["ยอดรวมทั้งหมด: ฿",b.toFixed(2)]}),(0,a.jsx)("button",{onClick:()=>o(b),className:"text-orange-600 hover:text-orange-700 hover:underline",type:"button",children:"ใช้ยอดรวมทั้งหมด"})]})]})]}),c&&(0,a.jsxs)("div",{className:"mt-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border border-blue-200",children:[(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"PromptPay QR Code"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"สแกนเพื่อชำระเงิน"})]}),(0,a.jsx)(P,{amount:n})]}),(0,a.jsx)("button",{onClick:m,className:"w-full mt-6 bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3 px-4 rounded-xl font-medium hover:from-orange-600 hover:to-orange-700 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-all duration-200 shadow-lg",children:"cash"===l?"ยืนยันการชำระเงินสด":"ยืนยันการชำระเงิน PromptPay"}),h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white/95 backdrop-blur-md rounded-2xl p-6 shadow-2xl w-full max-w-md mx-4 border border-white/20",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-orange-600"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"ค่าแรงงาน"})]}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"จำนวนเงินค่าแรงงาน"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"฿"}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>x(Number(e.target.value)||0),className:"w-full pl-8 pr-3 py-3 border text-gray-700 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors bg-white/80 backdrop-blur-sm",placeholder:"0.00",step:"0.01",min:"0"})]})]}),(0,a.jsxs)("div",{className:"bg-white/60 backdrop-blur-sm rounded-xl p-4 space-y-2 border border-white/30",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"ยอดรวมสินค้า:"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["฿",t.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"ค่าแรงงาน:"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["฿",d.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm border-t border-gray-200/50 pt-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"รวมก่อน VAT:"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["฿",u.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"VAT 7%:"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["฿",j.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-lg font-semibold border-t border-gray-200/50 pt-2",children:[(0,a.jsx)("span",{className:"text-gray-900",children:"ยอดรวมทั้งหมด:"}),(0,a.jsxs)("span",{className:"text-orange-600",children:["฿",b.toFixed(2)]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>g(!1),className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100/80 backdrop-blur-sm rounded-xl hover:bg-gray-200/90 transition-all duration-200 font-medium border border-gray-200/50",children:"ยกเลิก"}),(0,a.jsx)("button",{onClick:()=>g(!1),className:"flex-1 px-4 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:scale-105",children:"ยืนยัน"})]})]})})]})}var F=t(646);function R(e){let{loading:s,error:t,success:r}=e;return s?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"กำลังโหลดข้อมูล..."})]})}):t?(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-5 h-5 bg-red-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-3 h-3 bg-red-600 rounded-full"})}),(0,a.jsx)("p",{className:"text-sm text-red-700",children:t})]})}):r?(0,a.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-5 h-5 bg-green-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(F.A,{className:"w-3 h-3 text-green-600"})}),(0,a.jsx)("p",{className:"text-sm text-green-700",children:r})]})}):null}function E(){let{user:e}=(0,l.A)(),[s,t]=(0,r.useState)([]),[c,d]=(0,r.useState)(null),[i,m]=(0,r.useState)(null),[h,g]=(0,r.useState)(!1),[u,b]=(0,r.useState)(null),[y,N]=(0,r.useState)(null),[f,v]=(0,r.useState)("cash"),[w,A]=(0,r.useState)(0),[k,C]=(0,r.useState)(!1),[P,F]=(0,r.useState)(0);(0,r.useEffect)(()=>{(async()=>{try{console.log("Fetching job orders with status IN_PROGRESS...");let e=await fetch("".concat("http://localhost:5001","/job-orders?status=IN_PROGRESS"),{credentials:"include"});if(console.log("Response status:",e.status),console.log("Response headers:",e.headers),e.ok){let s=await e.json();console.log("Job orders data:",s),t(s)}else{let s=await e.json();console.error("Failed to fetch job orders:",e.status,s)}}catch(e){console.error("Error fetching job orders:",e)}})()},[]),(0,r.useEffect)(()=>{if(!c){m(null),b(null),N(null);return}(async()=>{g(!0);try{console.log("Fetching job order details for ID:",c);let e=await fetch("".concat("http://localhost:5001","/job-orders/").concat(c),{credentials:"include"});if(console.log("Job order response status:",e.status),!e.ok){let s=await e.json();throw console.error("Job order API error:",s),Error("Failed to fetch job order")}let s=await e.json();console.log("Fetched job order:",s),console.log("Fetching stock transactions for job order:",c);let t=await fetch("".concat("http://localhost:5001","/stock-transactions?jobOrderId=").concat(c,"&type=SALE"),{credentials:"include"});if(console.log("Stock transactions response status:",t.status),!t.ok){let e=await t.json();throw console.error("Stock transactions API error:",e),Error("Failed to fetch stock transactions")}let a=await t.json();console.log("Fetched stock transactions:",a);let r=a.reduce((e,s)=>e+s.product.sellPrice*Math.abs(s.qtyChange),0);m({jobOrder:s,transactions:a,totalAmount:r}),A(r)}catch(e){console.error("Error fetching billing data:",e),m(null),b((null==e?void 0:e.message)||"เกิดข้อผิดพลาดในการโหลดข้อมูล")}finally{g(!1)}})()},[c]);let E=async()=>{if(console.log("Confirming payment for job order:",c),c&&i){g(!0);try{console.log("Confirming payment for job order:",c);let e=i.transactions.reduce((e,s)=>e+s.product.sellPrice*Math.abs(s.qtyChange),0),s=Math.round((e+P)*.07),a=e+P+s,r="promptpay"===f?"PROMPTPAY":"CASH";console.log("Financial data:",{subtotal:e,laborCost:P,vatAmount:s,grandTotal:a,paymentMethod:r});let l=await fetch("".concat("http://localhost:5001","/job-orders/").concat(c,"/complete"),{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({paymentMethod:f,totalAmount:a,completedAt:new Date().toISOString(),subtotal:e,laborCost:P,vatAmount:s,grandTotal:a})});if(!l.ok){let e=await l.json();throw Error(e.message||"Failed to complete job order")}let n=await l.json();console.log("Job order completed:",n),N("การชำระเงินเสร็จสิ้นแล้ว! สถานะงานถูกอัพเดทเป็น 'เสร็จสิ้น'");let o=await fetch("".concat("http://localhost:5001","/job-orders?status=IN_PROGRESS"),{credentials:"include"});if(o.ok){let e=await o.json();t(e)}d(null),m(null),b(null),v("cash"),A(0),C(!1)}catch(e){console.error("Error confirming payment:",e),b((null==e?void 0:e.message)||"เกิดข้อผิดพลาดในการยืนยันการชำระเงิน")}finally{g(!1)}}};return e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-20xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)(o,{onPrint:()=>{window.print()},onDownload:()=>{console.log("Downloading PDF...")}}),(0,a.jsx)(x,{jobOrders:s,selectedJobOrderId:c,onJobOrderSelect:d}),(0,a.jsx)(R,{loading:h,error:u,success:y}),!h&&i&&(0,a.jsxs)("div",{className:"grid grid-cols-1 2xl:grid-cols-4 gap-10",children:[(0,a.jsxs)("div",{className:"2xl:col-span-3 space-y-6",children:[(0,a.jsx)(j,{jobOrder:i.jobOrder}),(0,a.jsx)(p,{transactions:i.transactions})]}),(0,a.jsx)("div",{className:"2xl:col-span-1 space-y-6",children:(0,a.jsx)(S,{transactions:i.transactions,totalAmount:i.totalAmount,selectedPaymentMethod:f,promptPayAmount:w,showQR:k,laborCost:P,onPaymentMethodChange:e=>{v(e),"promptpay"===e?C(!0):C(!1)},onPromptPayAmountChange:A,onLaborCostChange:F,onConfirmPayment:E})})]}),!h&&!i&&c&&(0,a.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,a.jsx)(n.A,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("p",{children:"ไม่พบข้อมูลสำหรับงานสั่งทำที่เลือก"})]})]})}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"กรุณาเข้าสู่ระบบ"}),(0,a.jsx)("p",{className:"text-gray-600",children:"คุณต้องเข้าสู่ระบบเพื่อดูหน้านี้"})]})})}},5991:(e,s,t)=>{Promise.resolve().then(t.bind(t,4122))}},e=>{e.O(0,[331,441,964,358],()=>e(e.s=5991)),_N_E=e.O()}]);